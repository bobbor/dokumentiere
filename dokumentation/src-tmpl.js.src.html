<!DOCTYPE html><html><head><meta charset="utf-8"><title>src\tmpl.js Dokumentation (Source)</title><link rel="stylesheet" href="css/style.css" media="all"><link rel="stylesheet" href="css/font-awesome.css" media="all"><link rel="stylesheet" href="css/sh.min.css" media="all"><script src="js/sh_main.min.js"></script><script src="js/sh_javascript.min.js"></script><script data-main="js/main.js" src="js/libs/require-jquery.js"></script></head><body id="source" onload="sh_highlightDocument();"><div id="wrapper"><div id="main"><aside class="items"><header><h1><a href="index.html"><em>Aperto</em><span><b>JS</b>Docs</span></a></h1></header><div id="filter"><form><div class="col col-3"><input type="search" placeholder="Suche" name="filter"><button><span>Los</span></button></div><div class="col col-9"><ul class="props"><li><input id="node-module" type="checkbox" name="node-module" checked><label for="node-module">node-module</label></li></ul></div></form></div><section data-type="node-module" data-name="doku" class="col col-3"><h1><a href="node.doku.html">doku</a></h1><h2>node-module (node)</h2><p>starts documentation on the files</p></section><section data-type="node-module" data-name="foldercopy" class="col col-3"><h1><a href="node.foldercopy.html">foldercopy</a></h1><h2>node-module (node)</h2><p>copies the specified folder</p></section><section data-type="node-module" data-name="tags" class="col col-3"><h1><a href="node.tags.html">tags</a></h1><h2>node-module (node)</h2><p>this parses the &quot;tags&quot;</p></section><section data-type="node-module" data-name="tmpl" class="col col-3"><h1><a href="node.tmpl.html">tmpl</a></h1><h2>node-module (node)</h2><p>gets the parsed comments and generates the html</p></section></aside><div id="content"><h1> <span>Source View</span>src\tmpl.js</h1><pre class="sh_javascript">//
// /--------------------------------------------\
// |                                            |
// | tmpl.js                                    |
// | part of &quot;dokumentiere&quot;                     |
// | licensed under GPLv2                       |
// |                                            |
// \--------------------------------------------/

var jade = require( 'jade' );
var cwd = process.cwd();
var path = require( 'path' );
var fs = require( 'fs' );
var fc = require( './foldercopy' );

/*-
 * tmpl
 [ node-module (node) ]
 * gets the parsed comments and generates the html
 &gt; Usage
 | var tmpl = require('tmpl');
 -*/
var tmpl = {
	/*-
	 * generate(obj, out)
	 [ function (public) ]
	 * iterates over the generated object and generates html for each 
	 * file and an index file @see function-index function-items
	 &gt; Parameter
	 - obj (object) the comment-parsed object
	 - out (string) the folder to put the documentation to
	 -*/
	generate: function( obj, out ) {
		this.out = out;
		var index = [];
		var types = [];
		for( var prop in obj) {
			if ( obj.hasOwnProperty( prop ) ) {
				index = index.concat( obj[prop] );
				for( var i = 0, file = obj[prop], len = file.length; i &lt; len; i++) {
					if ( !~types.indexOf( file[i].type ) ) {
						types.push( file[i].type );
					}
				}
			}
		}
		this.index( index, types );
		
		for( var prop in obj) {
			if ( obj.hasOwnProperty( prop ) ) {
				this.items( obj[prop], prop, index, types );
			}
		}
		
		fc.recursiveCopy( ['css', 'img', 'js'], ['templates', 'public'], out );
	},
	/*-
	 * index(arr, types)
	 [ function (public) ]
	 * generates the index-file @see function-render
	 * to adjust HTML see index.jade in the templates folder
	 &gt; Parameter
	 - arr (array) the array of files documented
	 - types (array) the array of types of documented elements
	 -*/
	index: function( arr, types ) {
		var that = this;
		this.render( 'index', {
			index: arr,
			types: types
		}, function() {
			that.writeHTML.apply( that, arguments );
		} );
	},
	/*-
	 * items(arr, file, index, types)
	 [ function (public) ]
	 * generates the markup for each file @see function-render
	 * to adjust HTML see module.jade in the templates folder
	 &gt; Parameter
	 - arr (array) the array of all parsed elements in a file
	 - file (string) the name of the file, in which the element is
	 - index (array) the array of all elements adjusted for index @see function-index
	 - types (array) an array of all types
	 -*/
	items: function( arr, file, index, types ) {
		var that = this;
		this.render('src', {
			index: index,
			types: types,
			src: arr.src,
			name: file
		}, function() {
			that.writeHTML.apply(that, arguments);
		});
		for( var i = 0, len = arr.length; i &lt; len; i++) {
			this.render( 'module', {
				index: index,
				item: arr[i],
				file: file,
				link: file.replace(new RegExp('\\'+path.sep, 'g'), '-')+'.src.html',
				types: types
			}, function() {
				that.writeHTML.apply( that, arguments );
			} );
		}
	},
	/*-
	 * render(tmplName, data, callback)
	 [ function (public) ]
	 * compiles the data
	 * passes the data to the jade compiler and calls the given callback with the html
	 &gt; Parameter
	 - tmplName (string) the name of the template to use
	 - data (object) the data to compile
	 - callback (function) the function to call with the html
	 -*/
	render: function( tmplName, data, callback ) {
		var name = __dirname + path.sep + 'templates' + path.sep + tmplName + '.jade';
		fs.readFile( name, 'utf8', function( err, content ) {
			if ( err ) {
				throw err;
			}
			var fn = jade.compile( content, {
				filename: name,
				self: true
			} );
			callback( fn( data ), 
				data.item
					? ((data.item.scope || data.item.visibility) + '.' + (data.item &amp;&amp; data.item.name))
					: data.src
						? data.name.replace(new RegExp('\\'+path.sep, 'g'), '-') + '.src' 
						: 'index'
			);
		} );
	},
	/*-
	 * writeHTML(html, name);
	 [ function (public) ]
	 * writes html! simple as that
	 * writes the given html to the defined path-name
	 &gt; Parameter
	 - html (string) the compiled HTML
	 - name (string) the name of the file to write to
	 -*/
	writeHTML: function( html, name ) {
		fs.writeFile( cwd + path.sep + this.out + path.sep + name + '.html', html, 'utf8', function( err ) {
			if ( err ) {
				console.log( 'could not document ' + name + '.html, because: ' );
				console.log( err );
				return;
			}
			// console.log('documented '+name+'.html');
		} );
	}
};

module.exports = tmpl;
</pre></div></div></div></body></html>