<!DOCTYPE html><html><head><meta charset="utf-8"><title>src\doku.js Dokumentation (Source)</title><link rel="stylesheet" href="css/jquery.jscrollpane.css" media="all"><link rel="stylesheet" href="css/style.css" media="all"><link rel="stylesheet" href="css/font-awesome.css" media="all"><link rel="stylesheet" href="css/sh.min.css" media="all"><script src="js/sh_main.min.js"></script><script src="js/sh_javascript.min.js"></script><script data-main="js/main.js" src="js/libs/require-jquery.js"></script><script>$(function() {
 if(location.hash) {
  var name = location.hash.substring(1, location.hash.length);
  $('a[name="'+name+'"]').addClass('highlight');
 }
})</script></head><body id="source" onload="sh_highlightDocument();"><div id="wrapper"><div id="main"><aside class="items"><header><h1><a href="index.html"><em>Aperto</em><span><b>JS</b>Docs</span></a></h1></header><div id="filter"><form><div class="col col-3"><input type="search" placeholder="Suche" name="filter"><button><span>Los</span></button></div><div class="col col-9"><ul class="props"><li><input id="node-module" type="checkbox" name="node-module" checked><label for="node-module">node-module</label></li></ul></div></form></div><section data-type="node-module" data-name="doku" class="col col-3"><h1><a href="node.doku.html">doku</a></h1><h2>node-module (node)</h2><p>starts documentation on the files</p></section><section data-type="node-module" data-name="foldercopy" class="col col-3"><h1><a href="node.foldercopy.html">foldercopy</a></h1><h2>node-module (node)</h2><p>copies the specified folder</p></section><section data-type="node-module" data-name="tags" class="col col-3"><h1><a href="node.tags.html">tags</a></h1><h2>node-module (node)</h2><p>this parses the &quot;tags&quot;</p></section><section data-type="node-module" data-name="tmpl" class="col col-3"><h1><a href="node.tmpl.html">tmpl</a></h1><h2>node-module (node)</h2><p>gets the parsed comments and generates the html</p></section></aside><div id="content"><h1> <span>Source View</span>src\doku.js</h1><pre class="sh_javascript"><a name="line-1" data-line="1">//
</a><a name="line-2" data-line="2">// /--------------------------------------------\
</a><a name="line-3" data-line="3">// |                                            |
</a><a name="line-4" data-line="4">// | doku.js                                    |
</a><a name="line-5" data-line="5">// | part of &quot;dokumentiere&quot;                     |
</a><a name="line-6" data-line="6">// | licensed under GPLv2                       |
</a><a name="line-7" data-line="7">// |                                            |
</a><a name="line-8" data-line="8">// \--------------------------------------------/
</a><a name="line-9" data-line="9">
</a><a name="line-10" data-line="10">var fs = require( 'fs' );
</a><a name="line-11" data-line="11">var parseLine = require( './tags' ).parseLine;
</a><a name="line-12" data-line="12">var tmpl = require( './tmpl' );
</a><a name="line-13" data-line="13">
</a><a name="line-14" data-line="14">/*-
</a><a name="line-15" data-line="15"> * doku
</a><a name="line-16" data-line="16"> [ node-module (node) ]
</a><a name="line-17" data-line="17"> : bobbor
</a><a name="line-18" data-line="18"> * starts documentation on the files
</a><a name="line-19" data-line="19"> &gt; Properties
</a><a name="line-20" data-line="20"> - version (string) &lt;'0.5.0'&gt; the version of the module
</a><a name="line-21" data-line="21"> &gt; Usage
</a><a name="line-22" data-line="22"> | var doku = require('doku');
</a><a name="line-23" data-line="23"> -*/
</a><a name="line-24" data-line="24">var doku = {
</a><a name="line-25" data-line="25">	version: '0.5.0',
</a><a name="line-26" data-line="26">	/*-
</a><a name="line-27" data-line="27">	 * parse(files, out)
</a><a name="line-28" data-line="28">	 [ function (public) ]
</a><a name="line-29" data-line="29">	 * parses the passed files
</a><a name="line-30" data-line="30">	 * iterates over the files, starts the file-parser, and starts the markup-generation when done. @see function-parseFile
</a><a name="line-31" data-line="31">	 &gt; Parameter
</a><a name="line-32" data-line="32">	 - files (array) the array of file-path's to document
</a><a name="line-33" data-line="33">	 - out (string) the folder to output to
</a><a name="line-34" data-line="34">	 -*/
</a><a name="line-35" data-line="35">	parse: function( files, out ) {
</a><a name="line-36" data-line="36">		var doku = this;
</a><a name="line-37" data-line="37">		var raw = {};
</a><a name="line-38" data-line="38">		
</a><a name="line-39" data-line="39">		/*
</a><a name="line-40" data-line="40">		 * clear empty function arrays
</a><a name="line-41" data-line="41">		 */
</a><a name="line-42" data-line="42">
</a><a name="line-43" data-line="43">		var clearFns = function() {
</a><a name="line-44" data-line="44">			this.forEach( function( elm, i ) {
</a><a name="line-45" data-line="45">				if ( elm.functions &amp;&amp; !elm.functions.length ) {
</a><a name="line-46" data-line="46">					delete elm.functions;
</a><a name="line-47" data-line="47">				}
</a><a name="line-48" data-line="48">			} );
</a><a name="line-49" data-line="49">		};
</a><a name="line-50" data-line="50">		
</a><a name="line-51" data-line="51">		/*
</a><a name="line-52" data-line="52">		 * inner iteration function
</a><a name="line-53" data-line="53">		 */
</a><a name="line-54" data-line="54">		var iterate = function( arr ) {
</a><a name="line-55" data-line="55">			if ( !arr.length ) {
</a><a name="line-56" data-line="56">				tmpl.generate( raw, out );
</a><a name="line-57" data-line="57">				return;
</a><a name="line-58" data-line="58">			}
</a><a name="line-59" data-line="59">			var file = arr.pop();
</a><a name="line-60" data-line="60">			fs.readFile( file.path, 'utf8', function( err, content ) {
</a><a name="line-61" data-line="61">				if ( err ) {
</a><a name="line-62" data-line="62">					throw err;
</a><a name="line-63" data-line="63">				}
</a><a name="line-64" data-line="64">				raw[file.name] = doku.parseFile( content, file.name );
</a><a name="line-65" data-line="65">				clearFns.call( raw[file.name] );
</a><a name="line-66" data-line="66">				raw[file.name].src = content.replace( /\r\n/gm, '\n' ).split('\n');
</a><a name="line-67" data-line="67">				iterate( arr );
</a><a name="line-68" data-line="68">			} );
</a><a name="line-69" data-line="69">		};
</a><a name="line-70" data-line="70">		
</a><a name="line-71" data-line="71">		iterate( files );
</a><a name="line-72" data-line="72">	},
</a><a name="line-73" data-line="73">	/*-
</a><a name="line-74" data-line="74">	 * parseFile(text, fileName)
</a><a name="line-75" data-line="75">	 [ function (public) ]
</a><a name="line-76" data-line="76">	 * parses a single file
</a><a name="line-77" data-line="77">	 * greps all the comments and calls the commentparser for each comment @see function-parseComment
</a><a name="line-78" data-line="78">	 &gt; Parameter
</a><a name="line-79" data-line="79">	 - text (string) the string to parse ( in most cases the content of a file)
</a><a name="line-80" data-line="80">	 - fileName* (string) the name of the file to parse
</a><a name="line-81" data-line="81">	 = (array) an array holding the comments
</a><a name="line-82" data-line="82">	 -*/
</a><a name="line-83" data-line="83">	parseFile: function( text, fileName ) {
</a><a name="line-84" data-line="84">		var parsedText = text.replace( /\r\n/gm, '\n' ).replace( /\t/g, '' );
</a><a name="line-85" data-line="85">		var comment = [];
</a><a name="line-86" data-line="86">		var doku = [];
</a><a name="line-87" data-line="87">		var ret = [];
</a><a name="line-88" data-line="88">		var t, i, len;
</a><a name="line-89" data-line="89">		var inComment = false;
</a><a name="line-90" data-line="90">		parsedText = parsedText.split( '\n' );
</a><a name="line-91" data-line="91">		var beginningLine = 0;
</a><a name="line-92" data-line="92">		for(i = 0, len = parsedText.length; i &lt; len; i++) {
</a><a name="line-93" data-line="93">			t = parsedText[i].trim();
</a><a name="line-94" data-line="94">			if ( t.indexOf( '-*/' ) === 0 ) {
</a><a name="line-95" data-line="95">				if ( inComment ) {
</a><a name="line-96" data-line="96">					doku.push( this.parseComment( comment, beginningLine+1 ) );
</a><a name="line-97" data-line="97">					comment = [];
</a><a name="line-98" data-line="98">				}
</a><a name="line-99" data-line="99">				inComment = false;
</a><a name="line-100" data-line="100">			}
</a><a name="line-101" data-line="101">			if ( inComment ) {
</a><a name="line-102" data-line="102">				t &amp;&amp; comment.push( t );
</a><a name="line-103" data-line="103">			}
</a><a name="line-104" data-line="104">			if ( t.indexOf( '/*-' ) === 0 ) {
</a><a name="line-105" data-line="105">				inComment = true;
</a><a name="line-106" data-line="106">				beginningLine = i;
</a><a name="line-107" data-line="107">			}
</a><a name="line-108" data-line="108">		}
</a><a name="line-109" data-line="109">		
</a><a name="line-110" data-line="110">		for(i = 0, len = doku.length; i &lt; len; i++) {
</a><a name="line-111" data-line="111">			if ( doku[i].scope ) {
</a><a name="line-112" data-line="112">				ret.push( doku[i] );
</a><a name="line-113" data-line="113">				if ( doku[i].type !== 'function' ) {
</a><a name="line-114" data-line="114">					ret[ret.length - 1].functions = [];
</a><a name="line-115" data-line="115">				}
</a><a name="line-116" data-line="116">			} else if ( doku[i].visibility ) {
</a><a name="line-117" data-line="117">				if ( ret[ret.length - 1] &amp;&amp; ret[ret.length - 1].functions ) {
</a><a name="line-118" data-line="118">					ret[ret.length - 1].functions.push( doku[i] );
</a><a name="line-119" data-line="119">				} else {
</a><a name="line-120" data-line="120">					ret.push( doku[i] );
</a><a name="line-121" data-line="121">				}
</a><a name="line-122" data-line="122">			} else if ( doku[i].type !== 'function' ) {
</a><a name="line-123" data-line="123">				ret.push( doku[i] );
</a><a name="line-124" data-line="124">			}
</a><a name="line-125" data-line="125">		}
</a><a name="line-126" data-line="126">		return ret;
</a><a name="line-127" data-line="127">	},
</a><a name="line-128" data-line="128">	/*-
</a><a name="line-129" data-line="129">	 * parseComment(comment)
</a><a name="line-130" data-line="130">	 [ function (public) ]
</a><a name="line-131" data-line="131">	 * parses a comment and generates an object for the tags and lines
</a><a name="line-132" data-line="132">	 &gt; Parameter
</a><a name="line-133" data-line="133">	 - comment (string) the comment to parse
</a><a name="line-134" data-line="134">	 = (object) the result of the parsing
</a><a name="line-135" data-line="135">	 -*/
</a><a name="line-136" data-line="136">	parseComment: function( comment, line) {
</a><a name="line-137" data-line="137">		var co = {
</a><a name="line-138" data-line="138">			name: comment[0],
</a><a name="line-139" data-line="139">			type: comment[1],
</a><a name="line-140" data-line="140">			line: line
</a><a name="line-141" data-line="141">		};
</a><a name="line-142" data-line="142">		function setupType( type ) {
</a><a name="line-143" data-line="143">			type = type.replace( /\[(\s|\s+)([\S\s]+)(\s|\s+)\]/, &quot;$2&quot; ).trim();
</a><a name="line-144" data-line="144">			if ( type.indexOf( '(' ) !== -1 ) {
</a><a name="line-145" data-line="145">				this.scope = type.substring( type.indexOf( '(' ) + 1, type.indexOf( ')' ) );
</a><a name="line-146" data-line="146">				if ( this.scope === 'public' || this.scope === 'private' ) {
</a><a name="line-147" data-line="147">					this.visibility = this.scope;
</a><a name="line-148" data-line="148">					delete this.scope;
</a><a name="line-149" data-line="149">				}
</a><a name="line-150" data-line="150">				this.type = type.substring( 0, type.indexOf( '(' ) - 1 );
</a><a name="line-151" data-line="151">			} else {
</a><a name="line-152" data-line="152">				this.type = type;
</a><a name="line-153" data-line="153">			}
</a><a name="line-154" data-line="154">		}
</a><a name="line-155" data-line="155">		co.name = co.name.substring( 1, co.name.length ).trim();
</a><a name="line-156" data-line="156">		setupType.call( co, co.type );
</a><a name="line-157" data-line="157">		for( var i = 2, len = comment.length; i &lt; len; i++) {
</a><a name="line-158" data-line="158">			parseLine( co, comment[i] );
</a><a name="line-159" data-line="159">		}
</a><a name="line-160" data-line="160">		return co;
</a><a name="line-161" data-line="161">	}
</a><a name="line-162" data-line="162">};
</a><a name="line-163" data-line="163">
</a><a name="line-164" data-line="164">module.exports = doku;
</a><a name="line-165" data-line="165">
</a></pre></div></div></div></body></html>