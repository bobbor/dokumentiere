<!DOCTYPE html><html><head><meta charset="utf-8"><title>src\doku.js Dokumentation (Source)</title><link rel="stylesheet" href="css/style.css" media="all"><link rel="stylesheet" href="css/font-awesome.css" media="all"><link rel="stylesheet" href="css/sh.min.css" media="all"><script src="js/sh_main.min.js"></script><script src="js/sh_javascript.min.js"></script><script data-main="js/main.js" src="js/libs/require-jquery.js"></script></head><body id="source" onload="sh_highlightDocument();"><div id="wrapper"><div id="main"><aside class="items"><header><h1><a href="index.html"><em>Aperto</em><span><b>JS</b>Bausteine</span><strong>Dokumentation</strong></a></h1></header><div id="filter"><form><div class="col col-3"><input type="search" placeholder="Suche" name="filter"><button><span>Los</span></button></div><div class="col col-9"><ul class="props"><li><input id="node-module" type="checkbox" name="node-module" checked><label for="node-module">node-module</label></li></ul></div></form></div><section data-type="node-module" data-name="doku" class="col col-3"><h1><a href="node.doku.html">doku</a></h1><h2>node-module (node)</h2><p>starts documentation on the files</p></section><section data-type="node-module" data-name="foldercopy" class="col col-3"><h1><a href="node.foldercopy.html">foldercopy</a></h1><h2>node-module (node)</h2><p>copies the specified folder</p></section><section data-type="node-module" data-name="tags" class="col col-3"><h1><a href="node.tags.html">tags</a></h1><h2>node-module (node)</h2><p>this parses the &quot;tags&quot;</p></section><section data-type="node-module" data-name="tmpl" class="col col-3"><h1><a href="node.tmpl.html">tmpl</a></h1><h2>node-module (node)</h2><p>gets the parsed comments and generates the html</p></section></aside><div id="content"><h1> <span>Source View</span>src\doku.js</h1><pre class="sh_javascript">//
// /--------------------------------------------\
// |                                            |
// | doku.js                                    |
// | part of &quot;dokumentiere&quot;                     |
// | licensed under GPLv2                       |
// |                                            |
// \--------------------------------------------/

var fs = require( 'fs' );
var parseLine = require( './tags' ).parseLine;
var tmpl = require( './tmpl' );

/*-
 * doku
 [ node-module (node) ]
 * starts documentation on the files
 &gt; Properties
 - version (string) &lt;'0.2.0'&gt; the version of the module
 &gt; Usage
 | var doku = require('doku');
 -*/
var doku = {
	version: '0.2.0',
	/*-
	 * parse(files, out)
	 [ function (public) ]
	 * parses the passed files
	 * iterates over the files, starts the file-parser, and starts the markup-generation when done. @see function-parseFile
	 &gt; Parameter
	 - files (array) the array of file-path's to document
	 - out (string) the folder to output to
	 -*/
	parse: function( files, out ) {
		var doku = this;
		var raw = {};
		
		/*
		 * clear empty function arrays
		 */

		var clearFns = function() {
			this.forEach( function( elm, i ) {
				if ( elm.functions &amp;&amp; !elm.functions.length ) {
					delete elm.functions;
				}
			} );
		};
		
		/*
		 * inner iteration function
		 */
		var iterate = function( arr ) {
			if ( !arr.length ) {
				tmpl.generate( raw, out );
				return;
			}
			var file = arr.pop();
			fs.readFile( file.path, 'utf8', function( err, content ) {
				if ( err ) {
					throw err;
				}
				raw[file.name] = doku.parseFile( content, file.name );
				clearFns.call( raw[file.name] );
				raw[file.name].src = content;
				iterate( arr );
			} );
		};
		
		iterate( files );
	},
	/*-
	 * parseFile(text, fileName)
	 [ function (public) ]
	 * parses a single file
	 * greps all the comments and calls the commentparser for each comment @see function-parseComment
	 &gt; Parameter
	 - text (string) the string to parse ( in most cases the content of a file)
	 - fileName* (string) the name of the file to parse
	 = (array) an array holding the comments
	 -*/
	parseFile: function( text, fileName ) {
		var parsedText = text.replace( /\r\n/gm, '\n' ).replace( /\t/g, '' );
		var comment = [];
		var doku = [];
		var ret = [];
		var t, i, len;
		var inComment = false;
		parsedText = parsedText.split( '\n' );
		
		for(i = 0, len = parsedText.length; i &lt; len; i++) {
			t = parsedText[i].trim();
			if ( t.indexOf( '-*/' ) === 0 ) {
				if ( inComment ) {
					doku.push( this.parseComment( comment ) );
					comment = [];
				}
				inComment = false;
			}
			if ( inComment ) {
				t &amp;&amp; comment.push( t );
			}
			if ( t.indexOf( '/*-' ) === 0 ) {
				inComment = true;
			}
		}
		
		for(i = 0, len = doku.length; i &lt; len; i++) {
			if ( doku[i].scope ) {
				ret.push( doku[i] );
				if ( doku[i].type !== 'function' ) {
					ret[ret.length - 1].functions = [];
				}
			} else if ( doku[i].visibility ) {
				if ( ret[ret.length - 1] &amp;&amp; ret[ret.length - 1].functions ) {
					ret[ret.length - 1].functions.push( doku[i] );
				} else {
					ret.push( doku[i] );
				}
			} else if ( doku[i].type !== 'function' ) {
				ret.push( doku[i] );
			}
		}
		return ret;
	},
	/*-
	 * parseComment(comment)
	 [ function (public) ]
	 * parses a comment and generates an object for the tags and lines
	 &gt; Parameter
	 - comment (string) the comment to parse
	 = (object) the result of the parsing
	 -*/
	parseComment: function( comment ) {
		var co = {
			name: comment[0],
			type: comment[1]
		};
		function setupType( type ) {
			type = type.replace( /\[(\s|\s+)([\S\s]+)(\s|\s+)\]/, &quot;$2&quot; ).trim();
			if ( type.indexOf( '(' ) !== -1 ) {
				this.scope = type.substring( type.indexOf( '(' ) + 1, type.indexOf( ')' ) );
				if ( this.scope === 'public' || this.scope === 'private' ) {
					this.visibility = this.scope;
					delete this.scope;
				}
				this.type = type.substring( 0, type.indexOf( '(' ) - 1 );
			} else {
				this.type = type;
			}
		}
		co.name = co.name.substring( 1, co.name.length ).trim();
		setupType.call( co, co.type );
		for( var i = 2, len = comment.length; i &lt; len; i++) {
			parseLine( co, comment[i] );
		}
		return co;
	}
};

module.exports = doku;
</pre></div></div></div></body></html>